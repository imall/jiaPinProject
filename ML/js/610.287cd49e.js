"use strict";(self["webpackChunkbos_designer"]=self["webpackChunkbos_designer"]||[]).push([[610],{7610:function(t,e,s){s.r(e),s.d(e,{default:function(){return d}});var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main",{staticClass:"box-border h-full min-h-[calc(100vh-84px)] w-full pb-[84px]"},[s("C-Back-Nav",{attrs:{title:(""!==t.currentMerchantName?t.currentMerchantName+" - ":"")+"打卡"}}),s("section",{staticClass:"relative z-0 mt-[52px] p-3"},[s("div",{staticClass:"mb-4 text-right"},[s("div",{staticClass:"inline-block w-fit cursor-pointer rounded-[10px] bg-primary px-2 py-1 text-white",on:{click:t.doRoute,keypress:t.doRoute}},[s("span",{staticClass:"mr-[6px]"},[t._v("打卡清單")]),s("font-awesome-icon",{attrs:{icon:"fa-regular fa-list"}})],1)]),s("div",{staticClass:" mb-3 text-7xl text-primary"},[t._v(" "+t._s(t._f("dateFmtHm")(t.currentTime))+" ")]),s("div",{staticClass:" text-sm font-medium text-primary"},[t._v(" "+t._s(t._f("dateFmtROCMMDD")(t.currentTime))+" "+t._s(t._f("dateFmtdd")(t.currentTime))+" ")]),s("div",{staticClass:"flex items-center justify-center gap-2"},[s("p",{staticClass:"whitespace-nowrap font-bold"},[t._v("位置狀態: ")]),s("p",{class:[{"text-orange-500":"距離介於25公尺以及50公尺"===t.locationInfo},{"text-red-600":"距離大於50公尺"===t.locationInfo||"無GPS座標"===t.locationInfo}]},[t._v(t._s(t.locationInfo))]),s("font-awesome-icon",{staticClass:" cursor-pointer text-primary",attrs:{icon:"fa-regular fa-arrows-rotate"},on:{click:t.reFreshLocation}})],1),s("div",{staticClass:"my-7 flex gap-2"},[s("div",{staticClass:"w-full cursor-pointer bg-second p-4 text-white",on:{click:function(e){return t.doAttendance("CLOCKIN")},keypress:function(e){return t.doAttendance("CLOCKIN")}}},[t._v("上班打卡")]),s("div",{staticClass:"w-full cursor-pointer bg-second p-4 text-white",on:{click:function(e){return t.doAttendance("CLOCKOUT")},keypress:function(e){return t.doAttendance("CLOCKOUT")}}},[t._v("下班打卡")])]),t.clockInRecordInList&&t.isHasNotClockout?s("div",{staticClass:"mb-7 flex gap-2"},[s("div",{staticClass:"w-full cursor-pointer bg-second/80 p-4 text-white",on:{click:function(e){t.doOutPunch(!0),t.doAttendance("BREAKSTART")},keypress:function(e){t.doOutPunch(!0),t.doAttendance("BREAKSTART")}}},[t._v("外出打卡")]),s("div",{staticClass:"w-full cursor-pointer bg-second/80  p-4 text-white",on:{click:function(e){t.doOutPunch(!1),t.doAttendance("BREAKEND")},keypress:function(e){t.doOutPunch(!1),t.doAttendance("BREAKEND")}}},[t._v("歸來打卡")])]):t._e(),t.isDailyClockInRecordHasClockInRecord?t._l(t.dailyClockInRecord.clockInRecord,(function(e,n){return s("div",{key:n,staticClass:"text-left",class:{"mb-4":t.isDailyClockInRecordHasClockInRecord}},[s("p",{staticClass:"flex break-all"},[s("span",{staticClass:" mr-2 whitespace-nowrap font-bold"},[t._v("上班時間:")]),s("span",{staticClass:"inline-block w-full underline decoration-black/20"},[t._v(t._s(e.in?t.timstampToMinSec(e.in["time"]):"尚未打卡"))])]),e.in?s("p",{staticClass:"flex break-all"},[s("span",{staticClass:" mr-2 whitespace-nowrap font-bold"},[t._v("外出時間:")]),s("span",{staticClass:"inline-block w-full underline decoration-black/20"},[t._v(" "+t._s(""===t.timstampListToMinSecConcatText(e.breakRecord,"start")?"未有打卡紀錄":t.timstampListToMinSecConcatText(e.breakRecord,"start"))+" ")])]):t._e(),e.in?s("p",{staticClass:"flex break-all"},[s("span",{staticClass:" mr-2 whitespace-nowrap font-bold"},[t._v("歸來時間:")]),s("span",{staticClass:"inline-block w-full underline decoration-black/20"},[t._v(" "+t._s(""===t.timstampListToMinSecConcatText(e.breakRecord,"end")?"未有打卡紀錄":t.timstampListToMinSecConcatText(e.breakRecord,"end"))+" ")])]):t._e(),s("p",{staticClass:"flex break-all"},[s("span",{staticClass:" mr-2 whitespace-nowrap font-bold"},[t._v("下班時間:")]),s("span",{staticClass:"inline-block w-full underline decoration-black/20"},[t._v(t._s(e.out?t.timstampToMinSec(e.out["time"]):"尚未打卡"))])])])})):[t._m(0)],s("hr",{staticClass:"my-7 border bg-primary"}),s("div",{staticClass:"text-left text-sm font-medium"},[s("div",{staticClass:"flex items-baseline"},[s("p",{staticClass:"min-w-[102px]"},[t._v("本月總打卡天數:")]),s("p",{staticClass:"mx-2 font-sans text-3xl"},[t._v(t._s(t.monthlyAttendanceCount)),s("span",{staticClass:"ml-1 text-sm"},[t._v("天")])])]),s("div",{staticClass:"flex items-baseline"},[s("p",{staticClass:"min-w-[102px]"},[t._v("遲到總分鐘數: ")]),s("p",{staticClass:"mx-2 font-sans text-3xl text-rejectText"},[t._v(t._s(t.monthlyAttendanceLateCount)),s("small",{staticClass:"ml-1 text-sm text-rejectText"},[t._v("分鐘")])])])])],2)],1)},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"text-left"},[s("p",{staticClass:"flex break-all"},[s("span",{staticClass:" mr-2 whitespace-nowrap font-bold"},[t._v("上班時間:")]),s("span",{staticClass:"inline-block w-full underline decoration-black/20"},[t._v("尚未打卡")])]),s("p",{staticClass:"flex break-all"},[s("span",{staticClass:" mr-2 whitespace-nowrap font-bold"},[t._v("下班時間:")]),s("span",{staticClass:"inline-block w-full underline decoration-black/20"},[t._v("尚未打卡")])])])}],i=s(629),o={name:"punch-index",description:"打卡的首頁",metaInfo:{title:"名留",titleTemplate:"%s | 打卡"},data(){return{resultItem:{},resultAttendance:{},punchStart:"",punchEnd:"",outPunchStart:"",outPunchEnd:"",locationInfo:"",currentTimeIntervalKey:"",currentTime:this.$dayjs().format("YYYY-MM-DD HH:mm:ss"),dailyClockInRecord:{}}},mounted(){this.currentTimeIntervalKey=setInterval((()=>{this.currentTime=this.$dayjs().format("YYYY-MM-DD HH:mm:ss")}),1e3),this.init()},methods:{async init(){await Promise.all([this.getAttendanceRecords(),this.getDailyClockInRecord(),this.reFreshLocation()]).then((()=>{}))},async reFreshLocation(){const{latitude:t,longitude:e}=await this.geoFindMe(),s=await this.$api.checkGPSStatus({latitude:t?`${t}`:t,longitude:e?`${e}`:e}),{data:n,errors:a}=s.data;if(a)return;const i=new Map([["NULL",{locationInfo:"無GPS座標"}],["LOWERTHAN25",{locationInfo:"距離小於25公尺"}],["BETWEEN25AND50",{locationInfo:"距離介於25公尺以及50公尺"}],["MORETHAN50",{locationInfo:"距離大於50公尺"}]]);this.locationInfo=i.get(n.checkGPSStatus.status)?i.get(n.checkGPSStatus.status).locationInfo:"無GPS座標"},async getDailyClockInRecord(){const t=await this.$api.dailyClockInRecord({date:this.$dayjs().valueOf(),designerId:this.userInfo.user.id}),{data:e,errors:s}=t.data;if(s)return;const[n={}]=e.dailyClockInRecord;this.dailyClockInRecord=n},async getAttendanceRecords(){const t={userId:this.userInfo.user.id,dateRange:{startDate:this.$dayjs(new Date).startOf("month").valueOf(),endDate:this.$dayjs(new Date).endOf("month").valueOf()},pageLimit:1e3},e=await this.$api.attendanceRecords(t),{data:s,errors:n}=e.data;n||(this.resultAttendance=s.attendanceRecords)},doRoute(){this.$router.push({name:"Punch-list"})},geoFindMe(){return new Promise((t=>{let{latitude:e,longitude:s}={};const n=n=>{e=n.coords.latitude,s=n.coords.longitude,t({latitude:e,longitude:s})},a=()=>{e=null,s=null,t({latitude:e,longitude:s})};navigator.geolocation?navigator.geolocation.getCurrentPosition(n,a):(this.$swal.fire({icon:"warning",title:"請開起與授權GPS定位功能",showConfirmButton:!0,showCancelButton:!0}),t({latitude:null,longitude:null}))}))},async doAttendance(t){await this.reFreshLocation();const{latitude:e,longitude:s}=await this.geoFindMe(),n=await this.$api.userClockIn({userIds:[this.userInfo.user.id],status:t,checkinType:"CELLPHONE",GPSLocation:e?{latitude:`${e}`,longitude:`${s}`}:null}),{data:a,errors:i}=n.data;await this.getAttendanceRecords(),i||(await this.getDailyClockInRecord(),a.userClockIn&&this.$swal.fire({showCloseButton:!0,html:'<div class="flex items-center justify-center my-10">\n              <img src="/designer/assets/images/success.svg" alt="" class="inline-block mr-1" /><span>打卡成功</span>\n            </div>',showConfirmButton:!1,timer:3e3,timerProgressBar:!0}))},doOutPunch(t){t?this.outPunchStart=this.$dayjs().format("HH:mm"):this.outPunchEnd=this.$dayjs().format("HH:mm")}},computed:{...(0,i.rn)("userInfo",["userInfo","currentMechantId"]),monthlyAttendanceCount(){let t=0;return this.resultAttendance[0]&&Array.isArray(this.resultAttendance[0].attendanceRecord)&&(t=this.resultAttendance[0].attendanceRecord.filter((t=>Object.prototype.hasOwnProperty.call(t,"clockInRecord")&&Array.isArray(t.clockInRecord)&&t.clockInRecord.length>0)).length),t},monthlyAttendanceLateCount(){let t=0;return t=this.resultAttendance[0]?this.resultAttendance[0].totalLateMinutes:0,t},currentMerchantName(){const t=this.userInfo?.user?.merchants.find((t=>t.id===this.currentMechantId));return t?t.name:""},clockInRecordInList(){let t="";const{clockInRecord:e=[]}=this.dailyClockInRecord;return t=e.flatMap((t=>t.in?this.$dayjs(t.in).format("HH:mm"):"")).toString(),t},timstampToMinSec(){return t=>this.$dayjs(t).isValid()?this.$dayjs(t).format("HH:mm"):t},timstampListToMinSecConcatText(){return(t,e)=>t.flatMap((t=>[t[e]&&this.$dayjs(t[e].time).isValid()?this.$dayjs(t[e].time).format("HH:mm"):[]])).toString()},isHasNotClockout(){let t=!1;const{clockInRecord:e=[]}=this.dailyClockInRecord;return t=e.some((t=>t&&null===t.out)),t},isDailyClockInRecordHasClockInRecord(){return this.dailyClockInRecord.clockInRecord&&this.dailyClockInRecord.clockInRecord.length>0}},beforeDestroy(){clearInterval(this.currentTimeIntervalKey)}},c=o,r=s(3736),l=(0,r.Z)(c,n,a,!1,null,null,null),d=l.exports}}]);
//# sourceMappingURL=610.287cd49e.js.map