"use strict";(self["webpackChunkbos_designer"]=self["webpackChunkbos_designer"]||[]).push([[833],{4833:function(t,e,i){i.r(e),i.d(e,{default:function(){return h}});var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main",{staticClass:"h-full w-full overflow-auto"},[s("section",{staticClass:"relative box-border min-h-screen w-full overflow-auto pb-[84px] md:rounded-2xl"},[s("nav",{staticClass:"relative mt-[41px] flex w-full items-end justify-between p-[14px]"},[s("img",{attrs:{src:i(1389),alt:""}}),s("C-Select",{staticClass:"w-[130px] text-center",attrs:{list:t.merchentList,placeholder:"選擇店家","item-text":"name","item-value":"id"},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}})],1),s("div",{staticClass:"m-auto my-6 mx-[14px] box-border flex h-fit w-[calc(100%-28px)] flex-wrap items-center justify-between rounded-[10px] border border-black py-[7px] px-4"},[s("div",{staticClass:"flex items-center justify-center"},[s("font-awesome-icon",{staticClass:"mr-4 text-2xl",attrs:{icon:"fa-regular fa-user"}}),s("div",{staticClass:" text-lg leading-8"},[t._v("設計師: "),s("span",{staticClass:"ml-2"},[t._v(t._s(t.userInfo?t.userInfo.user.name:""))])])],1),s("font-awesome-icon",{staticClass:"cursor-pointer text-2xl",attrs:{icon:"fa-regular fa-right-from-bracket"},on:{click:t.doLogout}})],1),s("div",{staticClass:"m-auto box-border flex h-fit w-full flex-wrap justify-around gap-4 px-[14px]"},[t._l(t.servicesList,(function(e,i){return[t.isAuthority(e.itemName)?s("div",{key:e.routeName+i,staticClass:"flex h-[100px] w-[165px] cursor-pointer flex-col items-center justify-center gap-3 rounded-[10px] border border-solid border-[#AEAEAE] bg-white shadow-2xl",on:{click:function(i){return t.doRoute(e.routeName)},keydown:function(i){return t.doRoute(e.routeName)}}},[s("img",{attrs:{src:e.iconSrc,alt:""}}),s("div",[t._v(t._s("設計師日報表"===e.itemName?"報表":e.itemName))])]):t._e()]}))],2),s("div",{staticClass:"fixed bottom-5 right-4 flex h-14 w-14 cursor-pointer items-center justify-center rounded-[28px] border border-solid  bg-white shadow-xl",on:{click:t.shareLink,keypress:t.shareLink}},[s("font-awesome-icon",{staticClass:"mr-1 text-4xl text-[#365cad]",attrs:{icon:"fa-regular fa-share-nodes"}})],1)])])},a=[],r=i(629),n=i(2325),o={name:"home-index",metaInfo:{title:"名留",titleTemplate:"%s | 首頁"},data(){return{selected:"",merchentList:[],servicesList:[{itemName:"預約審查",routeName:"Order",iconSrc:i(8929)},{itemName:"打卡",routeName:"Punch",iconSrc:i(823)},{itemName:"行事曆",routeName:"ScheduleBreak",iconSrc:i(5773)},{itemName:"設計師日報表",routeName:"Report",iconSrc:i(3665)},{itemName:"客戶資料查詢",routeName:"Customer",iconSrc:i(7962)}]}},computed:{...(0,r.rn)("userInfo",["userInfo","currentMechantId","userAuthorizeList"]),isAuthority(){return t=>this.userAuthorizeList.find((e=>e.pageName===t&&e.authority))}},mounted(){this.init()},methods:{...(0,r.nv)("userInfo",["SET_USER_PROFILE","SET_USER_CURRENT_MERCHANTID","SET_USER_AUTHORIZELIST"]),async shareLink(){const t=`${window.location.protocol}//${window.location.hostname}/login/?merchantId=${this.currentMechantId}&designerId=${this.userInfo.user.id}`;navigator.share?await navigator.share({title:"MINGLIU GROUP 名留集團",text:`MINGLIU GROUP 名留集團 設計師預約 設計師: ${this.userInfo.user.name}`,url:t}).then((()=>console.log("success"))).catch((e=>{window.open(t),console.error(e)})):window.open(t)},doRoute(t){this.$router.push({name:t})},async init(){await Promise.all([this.getMechants()]).then((()=>{}));const[t]=this.userInfo.user.merchants;this.selected=this.currentMechantId||t.id||""},async getMechants(){const t=await this.$api.user({id:this.userInfo.user.id}),{data:e,errors:i}=t.data;i||(this.merchentList=e.user.merchants)},doLogout(){this.$swal.fire({icon:"question",title:"您確定要登出嗎?",showConfirmButton:!0,showCancelButton:!0,showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp animate__faster"}}).then((async t=>{if(t.isConfirmed){const t=await this.$api.userLogout(),{data:e,errors:i}=t.data;if(i)return;if(!e.userLogout)return;await this.SET_USER_PROFILE(null),this.$swal.fire({icon:"success",title:"登出成功",showConfirmButton:!1,showCancelButton:!1,showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp animate__faster"},timer:3e3,timerProgressBar:!0}).then((()=>{this.$router.replace({name:"Login"})}))}}))},async getMe(){const t=await this.$api.me(),{data:e,errors:i}=t.data;if(!i)try{this.merchantIdentity=e.me.merchantIdentity}catch{this.merchantIdentity={}}},async getMerchantAuthorities(){const t=await this.$api.getMerchantAuthorities(),{data:e,errors:i}=t.data;if(!i)try{this.merchantAuthorities=e.getMerchantAuthorities}catch{this.merchantAuthorities=[]}},permissionReportList(){return new Promise((t=>{const e=this.merchantAuthorities.find((t=>t.id===this.merchantIdentity.authorityId)),i=e&&(0,n.p)(e.authoritySettings)?JSON.parse(e.authoritySettings):[];console.log(i);const s=i.flatMap((t=>"設計師端權限設定"!==t.pageTitle?[]:t.pageAuthority)),a=s.filter((t=>t.authority));t(a)}))},async swtichAuthority(t){await this.SET_USER_CURRENT_MERCHANTID(t),await this.getMe(),await this.getMerchantAuthorities();const e=await this.permissionReportList();await this.SET_USER_AUTHORIZELIST(e)}},watch:{selected(t){this.swtichAuthority(t)}}},c=o,u=i(3736),l=(0,u.Z)(c,s,a,!1,null,null,null),h=l.exports},8929:function(t,e,i){t.exports=i.p+"img/calendar-check-regular.20a22088.svg"},5773:function(t,e,i){t.exports=i.p+"img/calendar-days-regular.23986aa5.svg"},3665:function(t,e,i){t.exports=i.p+"img/chart-mixed-solid.096fb115.svg"},823:function(t,e,i){t.exports=i.p+"img/clock-regular.81063c4e.svg"},7962:function(t,e,i){t.exports=i.p+"img/users-light.3357b944.svg"}}]);
//# sourceMappingURL=833.a97cfdb6.js.map