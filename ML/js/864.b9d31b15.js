"use strict";(self["webpackChunkbos_designer"]=self["webpackChunkbos_designer"]||[]).push([[864],{9864:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"box-border h-full min-h-[calc(100vh-84px)] w-full pb-[84px]"},[s("C-Back-Nav",{attrs:{title:(""!==e.GETTER_MECHANTNAME?e.GETTER_MECHANTNAME+" - ":"")+"預約"}}),s("section",{staticClass:"relative z-0 mt-[52px] p-3"},[s("div",{staticClass:"mb-4 flex items-center justify-between"},[s("div",{staticClass:"rounded-[10px] bg-primary px-[14px] py-1 text-white",on:{click:function(t){return e.$router.push({name:"Order-add"})},keypress:function(t){return e.$router.push({name:"Order-add"})}}},[s("font-awesome-icon",{attrs:{icon:"fa-regular fa-circle-plus"}}),s("span",{staticClass:"ml-[6px]"},[e._v("新增預約")])],1),s("div",{staticClass:" flex items-center gap-2 text-left"},[s("div",{staticClass:"inline-block w-fit cursor-pointer rounded-[10px] bg-primary px-2 py-1 text-white",on:{click:function(t){return e.$router.push({name:"Order-list"})},keypress:function(t){return e.$router.push({name:"Order-list"})}}},[s("span",{staticClass:"mr-[6px]"},[e._v("列表查詢")]),s("font-awesome-icon",{attrs:{icon:"fa-regular fa-list"}})],1)])]),s("div",{staticClass:"mb-4 flex items-center justify-between gap-2"},[s("C-Input",{ref:"inputVal",staticClass:"mb-0 w-full",attrs:{placeholder:"搜尋姓名、電話、代號"},on:{doFunction:e.getOrders},scopedSlots:e._u([{key:"endIcon",fn:function(){return[""!==e.searchForm.keyword?s("font-awesome-icon",{staticClass:" text-rose-600",attrs:{icon:"fa-regular fa-xmark"},on:{click:e.doInitSearch}}):e._e(),s("font-awesome-icon",{attrs:{icon:"fa-regular fa-magnifying-glass"},on:{click:e.getOrders}})]},proxy:!0}]),model:{value:e.searchForm.keyword,callback:function(t){e.$set(e.searchForm,"keyword",t)},expression:"searchForm.keyword"}})],1),s("transition",{attrs:{name:"collapseTransition"}},[s("vc-date-picker",{directives:[{name:"show",rawName:"v-show",value:e.isActiveCalendar,expression:"isActiveCalendar"}],staticClass:"relative mt-[50px]",attrs:{locale:"zh-TW","select-attribute":e.selectedAttribute,"is-expanded":"",attributes:e.attrs,masks:e.masks},on:{"update:to-page":function(t){return e.swipeMonth(t)}},scopedSlots:e._u([{key:"header",fn:function(t){var a=t.year,r=t.monthLabel;return[s("div",{staticClass:"absolute inset-x-0 top-[-50px] w-full"},[s("div",{staticClass:"flex items-center justify-center"},[s("span",{staticClass:"font-bold"},[e._v(e._s(e._f("dateFormat")(a))+"年")]),s("span",{staticClass:"ml-2 text-2xl font-bold"},[e._v(e._s(r))])])])]}},{key:"header-left-button",fn:function(){return[s("font-awesome-icon",{staticClass:"absolute left-0 top-[-46px] text-2xl text-primary",attrs:{icon:"fa-solid fa-angle-left"},on:{click:function(t){return e.preNextMonth(-1)}}})]},proxy:!0},{key:"header-right-button",fn:function(){return[s("font-awesome-icon",{staticClass:"absolute right-0 top-[-46px] text-2xl text-primary",attrs:{icon:"fa-solid fa-angle-right"},on:{click:function(t){return e.preNextMonth(1)}}})]},proxy:!0},{key:"day-content",fn:function(t){var a=t.day,r=t.attributes;return[s("div",{staticClass:"z-10 flex flex-col"},[s("div",[s("p",{staticClass:"day-label relative my-2 text-sm text-gray-900",class:[e.$dayjs(e.searchForm.selectedDate).valueOf()===e.$dayjs(a.date).valueOf()?" before:contents-[``] before:m-auto  before:absolute before:inline-block before:h-[24px] before:w-[24px] before:top-[-1px] before:left-0 before:right-0 before:bg-[#feb401] before:z-[-1] before:rounded-[50%]":""],on:{click:function(t){e.searchForm.selectedDate=e.$dayjs(a.date).valueOf()},keypress:function(t){e.searchForm.selectedDate=e.$dayjs(a.date).valueOf()}}},[e._v(e._s(a.day))])]),s("div",{staticClass:"m-auto inline-block max-w-[13vmin] break-all"},[e.hasOnlyOrder(r)?s("span",{staticClass:"m-[2px] inline-block h-[5px] w-[5px] rounded-[50%] bg-[#feb401] content-['']"}):e._e()])])]}}]),model:{value:e.searchForm.selectedDate,callback:function(t){e.$set(e.searchForm,"selectedDate",t)},expression:"searchForm.selectedDate"}})],1),s("div",{staticClass:"text-left text-sm"},[s("p",{staticClass:"before:contents-[''] relative my-3 pl-2 before:absolute before:inset-0 before:h-full before:w-1 before:bg-primary"},[e._v("待審查("+e._s(e.isReviewResult)+")")]),e.isReviewResult?s("div",e._l(e.reviewResult,(function(t,a){return s("div",{key:"reviewItem"+a,staticClass:"mb-3 flex cursor-pointer items-center justify-between border-b border-solid border-primary/50 py-1 pl-2",on:{click:function(s){return e.doRoute(t,!0)},keypress:function(s){return e.doRoute(t,!0)}}},[s("div",{staticClass:"w-3/12"},[s("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:"fa-regular fa-calendar-days"}}),s("span",[e._v(e._s(e._f("dateFmtROCMMDD")(t.date)))])],1),s("div",{staticClass:"w-3/12"},[s("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:"fa-solid fa-clock-five"}}),s("span",[e._v(e._s(e._f("dateFmtHm")(t.date)))])],1),s("div",{staticClass:"w-3/12 overflow-hidden text-ellipsis whitespace-nowrap"},[s("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:"fa-solid fa-user"}}),s("span",[e._v(e._s(t.customer.name||"--"))])],1),s("div",{staticClass:"w-3/12 min-w-[42px]"},[s("span",{staticClass:"text-sucessText"},[e._v(e._s(t.status))])]),s("div",[s("font-awesome-icon",{attrs:{icon:"fa-solid fa-angle-right"}})],1)])})),0):s("div",{staticClass:"my-3  pl-2"},[e._v("目前沒有待審查的預約")])]),s("div",{staticClass:"text-left text-sm"},[s("p",{staticClass:"before:contents-[''] relative my-3 pl-2 before:absolute before:inset-0 before:h-full before:w-1 before:bg-primary"},[e._v("預約明細("+e._s(e.isOrderResult)+")")]),e.isOrderResult?s("div",e._l(e.orderResult,(function(t,a){return s("div",{key:"reviewItem"+a,staticClass:"mb-3 flex cursor-pointer items-center justify-between border-b border-solid border-primary/50 py-1 pl-2",on:{click:function(s){return e.doRoute(t,!1)},keypress:function(s){return e.doRoute(t,!1)}}},[s("div",{staticClass:"w-3/12"},[s("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:"fa-regular fa-calendar-days"}}),s("span",[e._v(e._s(e._f("dateFmtROCMMDD")(t.date)))])],1),s("div",{staticClass:"w-2/12"},[s("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:"fa-solid fa-clock-five"}}),s("span",[e._v(e._s(e._f("dateFmtHm")(t.date)))])],1),s("div",{staticClass:"w-3/12 overflow-hidden text-ellipsis whitespace-nowrap"},[s("font-awesome-icon",{staticClass:"mr-1",attrs:{icon:"fa-solid fa-user"}}),s("span",[e._v(e._s(t.customer.name||"--"))])],1),s("div",{staticClass:"w-3/12 min-w-[42px]"},[s("span",[e._v(e._s(t.status))])]),s("div",[s("font-awesome-icon",{attrs:{icon:"fa-solid fa-angle-right"}})],1)])})),0):s("div",{staticClass:"my-3  pl-2"},[e._v("目前沒有任何預約")])])],1)],1)},r=[],i=s(629),o={name:"order-index",description:"預約的首頁",metaInfo:{title:"名留",titleTemplate:"%s | 預約"},mounted(){this.init()},data(){return{masks:{weekdays:"WWW"},isActiveCalendar:!0,searchForm:{keyword:"",isAccurate:!0,selectedDate:this.$dayjs(this.$dayjs().format("YYYY-MM-DD")).valueOf()},monthkyOrdersDate:{start:this.$dayjs(new Date).startOf("month").valueOf(),end:this.$dayjs(new Date).endOf("month").valueOf()},attrs:[],reviewResult:[],orderResult:[],selectedAttribute:{highlight:{style:{background:"transparent"},fillMode:"solid"}}}},methods:{async init(){await Promise.all([this.getMonthlyOrders(),this.getOrders()]).then((()=>{}))},async doInitSearch(){this.searchForm.keyword="",await this.getOrders()},async getMonthlyOrders(){console.log("getMonthlyOrders");const e=await this.$api.orders({startDate:this.$dayjs(this.monthkyOrdersDate.start).isValid()?this.$dayjs(this.monthkyOrdersDate.start).valueOf():"",endDate:this.$dayjs(this.monthkyOrdersDate.end).isValid()?this.$dayjs(this.monthkyOrdersDate.end).valueOf():"",employeeId:this.userInfo.user.id,isReserved:!0}),{data:t,errors:s}=e.data;return s?{}:(this.attrs=Array.isArray(t.orders.orders)?t.orders.orders.flatMap((e=>"待審核"===e.status?[{key:`${e.id}`,customData:{class:"red"},dates:e.date}]:[{key:`${e.id}`,dates:e.date}])):[],this.$forceUpdate(),e)},async getOrders(){const e=await this.$api.orders({startDate:this.$dayjs(this.searchForm.selectedDate).isValid()?this.$dayjs(this.searchForm.selectedDate).valueOf():"",endDate:this.$dayjs(this.searchForm.selectedDate).isValid()?this.$dayjs(this.searchForm.selectedDate).valueOf():"",employeeId:this.userInfo.user.id,orderKeyword:{keyword:"string"===typeof this.searchForm.keyword?this.searchForm.keyword.toLocaleLowerCase():this.searchForm.keyword,isFuzzySearch:!0},isReserved:!0}),{data:t,errors:s}=e.data;return s?{}:(this.reviewResult=t.orders.orders.filter((e=>"待審核"===e.status)),this.orderResult=t.orders.orders.filter((e=>"待審核"!==e.status)),this.$forceUpdate(),e)},doRoute(e,t){this.$router.push({name:"Order-edit",query:{id:e.id,isReview:t}})},preNextMonth(e){this.monthkyOrdersDate.start=this.$dayjs(this.$dayjs(this.monthkyOrdersDate.start).add(e,"month")).startOf("month").format("YYYY-MM-DD"),this.monthkyOrdersDate.end=this.$dayjs(this.$dayjs(this.monthkyOrdersDate.end).add(e,"month")).endOf("month").format("YYYY-MM-DD")},swipeMonth(e){const t=e.year,s=e.month-1,a=new Date(t,s,1),r=new Date(t,s+1,0),i=this.$dayjs(a).format("YYYY-MM-DD"),o=this.$dayjs(r).format("YYYY-MM-DD");this.monthkyOrdersDate.start=i,this.monthkyOrdersDate.end=o}},computed:{...(0,i.rn)("userInfo",["userInfo","currentMechantId"]),...(0,i.Se)("userInfo",["GETTER_MECHANTNAME"]),isReviewResult(){return this.reviewResult.length},hasOnlyOrder(){return e=>{let t=!1;return Array.isArray(e)&&1===e.length&&(t=!e[0].highlight),Array.isArray(e)&&e.length>1&&(t=!0),t}},isOrderResult(){return this.orderResult.length}},watch:{"searchForm.selectedDate":{handler(){this.searchForm.selectedDate&&this.getOrders()}},monthkyOrdersDate:{deep:!0,handler(){this.getMonthlyOrders()}}}},n=o,l=s(3736),d=(0,l.Z)(n,a,r,!1,null,"249b794b",null),c=d.exports}}]);
//# sourceMappingURL=864.b9d31b15.js.map