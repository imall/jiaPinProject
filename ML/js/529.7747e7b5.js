"use strict";(self["webpackChunkbos_designer"]=self["webpackChunkbos_designer"]||[]).push([[529],{1529:function(t,e,s){s.r(e),s.d(e,{default:function(){return M}});var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main",{staticClass:"box-border h-full min-h-[calc(100vh-84px)] w-full pb-[160px]"},[s("C-Back-Nav",{attrs:{title:(""!==t.GETTER_MECHANTNAME?t.GETTER_MECHANTNAME+" - ":"")+"行事曆"}}),s("section",{staticClass:"relative z-0 mt-[52px] p-3"},[s("div",{staticClass:"relative z-10 my-4 flex w-6 items-center justify-between"},[s("font-awesome-icon",{staticClass:"text-2xl",attrs:{icon:"fa-regular fa-filter-list"},on:{click:function(e){t.isActiveFilter=!t.isActiveFilter}}})],1),"0"===t.showType?s("MonthView",{staticClass:"animate__animated animate__fadeInUp",attrs:{attributes:t.formatResult,seletedCategories:t.seleted,manaulUpdateFormResult:t.manaulUpdateFormResult},model:{value:t.monthlyOrdersDate,callback:function(e){t.monthlyOrdersDate=e},expression:"monthlyOrdersDate"}}):t._e(),"1"===t.showType?s("WeekView",{staticClass:"animate__animated animate__fadeInUp",attrs:{weekLst:t.weekLst,attributes:t.restructureScheduleTableWithTimeList,isRegularHoliday:t.restructureScheduleTableWithisRegualrHoliday,manaulUpdateFormResult:t.manaulUpdateFormResult},model:{value:t.period,callback:function(e){t.period=e},expression:"period"}}):t._e(),"2"===t.showType?s("DayView",{staticClass:"animate__animated animate__fadeInUp",attrs:{weekLst:t.weekLst,manaulUpdateFormResult:t.manaulUpdateFormResult,attributes:t.restructureScheduleTableWithTimeListOfDay,isRegularHoliday:t.restructureScheduleTableWithisRegualrHoliday},model:{value:t.today,callback:function(e){t.today=e},expression:"today"}}):t._e(),s("div",{staticClass:"fixed bottom-[100px] right-3 z-10 text-right"},[s("font-awesome-icon",{staticClass:" text-[78px]",attrs:{icon:"fa-regular fa-circle-plus"},on:{click:function(e){t.isDirect=!t.isDirect}}})],1)],1),s("C-Loading-Overlay",{attrs:{layerIndex:10},on:{doFunction:function(e){t.isDirect=!t.isDirect}},model:{value:t.isDirect,callback:function(e){t.isDirect=e},expression:"isDirect"}}),t.isDirect?s("div",{staticClass:"animate__animated animate__fadeInUp fixed inset-x-6 bottom-40 !z-10 mx-auto flex justify-end content-['']"},[s("div",{staticClass:"relative w-[150px] rounded-md bg-white after:absolute after:right-[calc(10%-0px)] after:bottom-[-20px] after:inline-block after:rotate-180 after:border-[10px] after:border-solid after:border-transparent after:border-b-white after:content-['']"},[s("div",{staticClass:"py-2 text-right text-black"},[s("div",{staticClass:"w-full cursor-pointer text-sm"},[s("p",{staticClass:" m-[8px] text-left text-2xl",on:{click:function(e){t.doRoute({name:"ScheduleBreak-Add"}),t.isDirect=!t.isDirect},keydown:function(e){t.doRoute({name:"ScheduleBreak-Add"}),t.isDirect=!t.isDirect}}},[t._v("新增預約")]),s("p",{staticClass:" m-[8px] text-left text-2xl",on:{click:function(e){t.doRoute({name:"ScheduleBreak-List"}),t.isDirect=!t.isDirect},keydown:function(e){t.doRoute({name:"ScheduleBreak-List"}),t.isDirect=!t.isDirect}}},[t._v("我的排休")])])])])]):t._e(),s("C-Loading-Overlay",{attrs:{layerIndex:10},on:{doFunction:function(e){t.isActiveFilter=!t.isActiveFilter}},model:{value:t.isActiveFilter,callback:function(e){t.isActiveFilter=e},expression:"isActiveFilter"}}),s("transition",{attrs:{name:"fromleft"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveFilter,expression:"isActiveFilter"}]},[s("div",{staticClass:"fixed inset-0 top-[180px] z-20 grid h-[calc(100%-180px)] w-full grid-cols-1 grid-rows-[37px_minmax(0,1fr)_62px] bg-white"},[s("p",{staticClass:"border-b border-solid border-primary p-2 text-sm"},[t._v("顯示行事曆")]),s("div",{staticClass:"p-[14px]"},[s("p",{staticClass:"mt-4 text-left font-semibold"},[t._v("瀏覽模式")]),s("div",{staticClass:"mb-4"},[s("div",{staticClass:"my-2 flex items-center gap-2"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showType,expression:"showType"}],attrs:{name:"showType",type:"radio",value:"0"},domProps:{checked:t._q(t.showType,"0")},on:{change:function(e){t.showType="0"}}}),s("label",{staticClass:"w-11/12 text-left"},[t._v("月曆模式")])]),s("div",{staticClass:"my-2 flex items-center gap-2"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showType,expression:"showType"}],attrs:{name:"showType",type:"radio",value:"1"},domProps:{checked:t._q(t.showType,"1")},on:{change:function(e){t.showType="1"}}}),s("label",{staticClass:"w-11/12 text-left"},[t._v("週模式")])]),s("div",{staticClass:"my-2 flex items-center gap-2"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showType,expression:"showType"}],attrs:{name:"showType",type:"radio",value:"2"},domProps:{checked:t._q(t.showType,"2")},on:{change:function(e){t.showType="2"}}}),s("label",{staticClass:"w-11/12 text-left"},[t._v("日模式")])])]),s("p",{staticClass:"text-left font-semibold"},[t._v("選擇類別")]),s("div",{staticClass:"mb-8"},[t.isAuthToAll&&t.isAuthority("全店行事曆")?s("div",{staticClass:"flex items-center gap-2"},[s("C-Checkbox-Full",{staticClass:"!w-1/12",attrs:{inputValue:"my"},model:{value:t.seletedAll,callback:function(e){t.seletedAll=e},expression:"seletedAll"}}),s("p",{staticClass:"w-11/12 text-left"},[t._v("全店行事曆")])],1):t._e(),s("div",{staticClass:"flex items-center gap-2"},[s("C-Checkbox-Full",{staticClass:"!w-1/12",attrs:{inputValue:"my"},model:{value:t.seleted,callback:function(e){t.seleted=e},expression:"seleted"}}),s("p",{staticClass:"w-11/12 text-left"},[t._v("指定預約")])],1),s("div",{staticClass:"flex items-center gap-2"},[s("C-Checkbox-Full",{staticClass:"!w-1/12",attrs:{inputValue:"others"},model:{value:t.seleted,callback:function(e){t.seleted=e},expression:"seleted"}}),s("p",{staticClass:"w-11/12 text-left"},[t._v("不指定預約")])],1),s("div",{staticClass:"flex items-center gap-2"},[s("C-Checkbox-Full",{staticClass:"!w-1/12",attrs:{inputValue:"break"},model:{value:t.seleted,callback:function(e){t.seleted=e},expression:"seleted"}}),s("p",{staticClass:"w-11/12 text-left"},[t._v("排休")])],1),s("div",{staticClass:"flex items-center gap-2"},[s("C-Checkbox-Full",{staticClass:"!w-1/12",attrs:{inputValue:"regularHoliday"},model:{value:t.seleted,callback:function(e){t.seleted=e},expression:"seleted"}}),s("p",{staticClass:"w-11/12 text-left"},[t._v("公休")])],1)])]),s("div",{staticClass:"my-3 mx-[14px] flex justify-around gap-3 "},[s("div",{staticClass:"w-full bg-second px-[14px] py-2 text-sm text-white",on:{click:function(e){t.isActiveFilter=!t.isActiveFilter},keypress:function(e){t.isActiveFilter=!t.isActiveFilter}}},[s("span",[t._v("關閉")])])])])])])],1)},i=[],r=(s(6699),s(629)),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("vc-date-picker",{staticClass:"custom-calendar max-w-full",attrs:{locale:"zh-TW","is-expanded":"",value:"",attributes:t.attributesfilterdByCategories,masks:t.masks},on:{"update:to-page":function(e){return t.swipeMonth(e)}},scopedSlots:t._u([{key:"header",fn:function(e){var a=e.year,i=e.monthLabel;return[s("div",{staticClass:"absolute inset-x-0 top-[-45px] w-full"},[s("div",{staticClass:"flex items-center justify-center"},[s("span",{staticClass:"font-bold"},[t._v(t._s(a)+"年")]),s("span",{staticClass:"ml-2 text-2xl font-bold"},[t._v(t._s(i))])])])]}},{key:"header-left-button",fn:function(){return[s("font-awesome-icon",{staticClass:"absolute right-[50px] top-[-41px] text-2xl text-primary",attrs:{icon:"fa-solid fa-angle-left"},on:{click:function(e){return t.preNextMonth(-1)}}})]},proxy:!0},{key:"header-right-button",fn:function(){return[s("font-awesome-icon",{staticClass:"absolute right-[3px] top-[-41px] text-2xl text-primary",attrs:{icon:"fa-solid fa-angle-right"},on:{click:function(e){return t.preNextMonth(1)}}})]},proxy:!0},{key:"day-content",fn:function(e){var a=e.day,i=e.attributes;return[s("div",{staticClass:"z-10 flex h-full flex-col overflow-hidden"},[s("span",{staticClass:"day-label text-sm text-gray-900"},[t._v(t._s(a.day))]),s("div",{staticClass:"grow overflow-auto"},[t._l(i,(function(e,r){return[t.toggleList["day"+a.day]||r<3?s("p",{directives:[{name:"ripple",rawName:"v-ripple",value:100,expression:"100"}],key:e.key+r,staticClass:"mt-0 mb-1 max-w-[13vmin] break-words rounded-sm p-1 text-xs leading-tight",class:[e.customData&&e.customData.class?e.customData.class:"",{"pointer-events-none":!e.customData}],on:{click:function(s){return t.doRoute(e)},keypress:function(s){return t.doRoute(e)}}},[t._v(" "+t._s(e.customData&&e.customData.title?e.customData.title:"")+" ")]):t._e(),t.toggleList["day"+a.day]||4!==r?t._e():s("p",{directives:[{name:"ripple",rawName:"v-ripple",value:100,expression:"100"}],key:e.key,staticClass:"mt-0 mb-1 rounded-sm bg-gray-400 p-1 text-xs leading-tight text-white",on:{click:function(e){return t.toggle("day"+a.day)},keypress:function(e){return t.toggle("day"+a.day)}}},[t._v(" +"+t._s(i.length-3)+" ")])]}))],2)])]}}])})},n=[],l={props:{value:{type:[Object,Array]},attributes:{type:[Array],default:()=>[]},seletedCategories:{type:[Array],default:()=>[]},manaulUpdateFormResult:{type:[Function],required:!0}},data(){return{masks:{weekdays:"WWW"},toggleList:{}}},methods:{swipeMonth(t){const e=t.year,s=t.month-1,a=new Date(e,s,1),i=new Date(e,s+1,0),r=this.$dayjs(a).format("YYYY-MM-DD"),o=this.$dayjs(i).format("YYYY-MM-DD");this.$emit("input",{start:r,end:o}),this.toggleList={}},doRoute(t){const e=["break","regularHoliday"];e.includes(t.customData.type)?this.$swal.fire({icon:"info",title:`${t.customData.title}`,showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"開放預約",customClass:{confirmButton:"!w-[144px] !rounded !bg-second !px-[14px] !py-2 !text-sm !text-white"},cancelButtonText:"關閉"}).then((async e=>{if(e.isConfirmed){if("break"===t.customData.type&&await this.$api.adminBookingTime({designerId:this.userInfo.user.id,datetime:t.dates[0].startTime,appointable:!0}),"bg-blue-400 text-white"===t.customData.class&&await this.$api.adminBookingTime({designerId:this.userInfo.user.id,datetime:t.dates[0].startTime,appointable:!0}),"bg-blue-600 text-white"===t.customData.class){const e=t.customData.bookingTimes.map((t=>new Promise((e=>{e(this.$api.adminBookingTime({designerId:this.userInfo.user.id,datetime:t.time,appointable:!0}))}))));await Promise.all(e)}await this.manaulUpdateFormResult()}})):this.$router.push({name:"ScheduleBreak-Detail",query:{id:t.key}})},preNextMonth(t){this.$emit("input",{start:this.$dayjs(this.$dayjs(this.propMonthlyOrdersDate.start).add(t,"month")).startOf("month").format("YYYY-MM-DD"),end:this.$dayjs(this.$dayjs(this.propMonthlyOrdersDate.end).add(t,"month")).endOf("month").format("YYYY-MM-DD")}),this.toggleList={}},toggle(t){this.toggleList[t]=!0,this.$forceUpdate()}},computed:{...(0,r.rn)("userInfo",["userInfo","currentMechantId"]),isSeletedCategories(){return t=>{let e=!1;return Array.isArray(this.seletedCategories)&&(e=0!==this.seletedCategories.length&&this.seletedCategories.includes(t)),e}},attributesfilterdByCategories(){return this.attributes.filter((t=>this.isSeletedCategories(t.customData.type)))},propMonthlyOrdersDate:{get(){return this.value},set(){this.$emit("input",this.propMonthlyOrdersDate)}}}},d=l,u=s(3736),c=(0,u.Z)(d,o,n,!1,null,"2436fb72",null),m=c.exports,h=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"flex items-center justify-between"},[s("div",{staticClass:"flex"},[s("div",{staticClass:"absolute inset-x-0 top-[-41px] m-auto whitespace-nowrap"},[s("span",[t._v(t._s(t._f("dateFmtROCMMDD")(t.weekLst[0])))]),s("span",[t._v(" ~ "+t._s(t.$dayjs(t.weekLst[6]).format("MM/DD")))])]),s("div",[s("font-awesome-icon",{staticClass:"absolute right-[50px] top-[-41px] text-2xl  text-primary",attrs:{icon:"fa-solid fa-angle-left"},on:{click:function(e){return t.preNextWeek(-7)}}}),s("font-awesome-icon",{staticClass:"absolute right-[-3px] top-[-41px] text-2xl text-primary",attrs:{icon:"fa-solid fa-angle-right"},on:{click:function(e){return t.preNextWeek(7)}}})],1)])]),s("div",{staticClass:"mt-2"},[s("div",{staticClass:"flex"},[s("div",{staticClass:"w-[12.5%] border border-solid border-primary"}),t._l(t.weekLst,(function(e,a){return s("div",{key:"week"+a,staticClass:"w-[12.5%] border border-solid border-primary"},[s("p",[t._v(t._s(t.$dayjs(e).format("M/D")))]),s("p",[t._v(t._s(t.$dayjs(e).format("(dd)")))])])}))],2),s("div",{staticClass:"flex"},[s("div",{staticClass:"w-[12.5%] border border-solid border-primary"},[t._v("整日公休")]),t._l(t.weekLst,(function(e,a){return s("div",{key:"week"+a,staticClass:"flex w-[12.5%] items-center justify-center border border-solid border-primary"},[t._l(t.isRegularHoliday,(function(i,r){return[i.dates===t.$dayjs(e).valueOf()?s("p",{key:"isRegularHoliday-"+a+"-"+r,staticClass:"my-1 w-full overflow-hidden text-ellipsis whitespace-nowrap bg-second p-1 text-xs leading-tight text-white ",class:i.customData.class,on:{click:function(e){return t.doRoute(i)},keypress:function(e){return t.doRoute(i)}}},[t._v(" "+t._s(i.customData.title))]):t._e()]}))],2)}))],2),s("div",t._l(t.attributes,(function(e,a){return s("div",{key:"resultItem"+a,staticClass:"flex"},[s("div",{staticClass:"w-[12.5%] border border-solid border-primary"},[t._v(t._s(e.time))]),t._l(e.date,(function(e,a){return s("div",{key:"innerItem"+a,staticClass:" flex w-[12.5%] cursor-pointer flex-wrap items-center justify-center border border-solid border-primary"},[Array.isArray(e)&&e.length>0?[t._l(e,(function(e,i){return[s("p",{key:"attributes"+a+"-"+i,staticClass:"my-1 w-full overflow-hidden text-ellipsis whitespace-nowrap bg-second p-1 text-xs leading-tight text-white ",class:e.customData.class,on:{click:function(s){return t.doRoute(e)},keypress:function(s){return t.doRoute(e)}}},[t._v(t._s(e.customData.title))])]}))]:t._e()],2)}))],2)})),0)])])},p=[],y={props:{value:{type:[Number,String]},weekLst:{type:[Array]},attributes:{type:[Array],default:()=>[]},isRegularHoliday:{type:[Array],default:()=>[]},manaulUpdateFormResult:{type:[Function],required:!0}},methods:{doRoute(t){console.log(t);const e=["break","regularHoliday"];e.includes(t.customData.type)?this.$swal.fire({icon:"info",title:`${t.customData.title}`,showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"開放預約",customClass:{confirmButton:"!w-[144px] !rounded !bg-second !px-[14px] !py-2 !text-sm !text-white"},cancelButtonText:"關閉"}).then((async e=>{if(e.isConfirmed){if("break"===t.customData.type&&await this.$api.adminBookingTime({designerId:this.userInfo.user.id,datetime:t.dates,appointable:!0}),"bg-blue-400 text-white"===t.customData.class&&await this.$api.adminBookingTime({designerId:this.userInfo.user.id,datetime:t.dates,appointable:!0}),"bg-blue-600 text-white"===t.customData.class){const e=t.customData.bookingTimes.map((t=>new Promise((e=>{e(this.$api.adminBookingTime({designerId:this.userInfo.user.id,datetime:t.time,appointable:!0}))}))));await Promise.all(e)}await this.manaulUpdateFormResult()}})):this.$router.push({name:"ScheduleBreak-Detail",query:{id:t.key}})},preNextWeek(t){this.$emit("input",this.value+t)}},computed:{...(0,r.rn)("userInfo",["userInfo","currentMechantId"])}},f=y,g=(0,u.Z)(f,h,p,!1,null,null,null),w=g.exports,x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"flex items-center justify-between"},[s("div",{staticClass:"flex"},[s("div",{staticClass:"absolute inset-x-0 top-[-41px] m-auto whitespace-nowrap"},[s("span",[t._v(t._s(t._f("dateFmtROCMMDD")(t.currentDay)))])]),s("div",[s("font-awesome-icon",{staticClass:"absolute right-[50px] top-[-41px] text-2xl  text-primary",attrs:{icon:"fa-solid fa-angle-left"},on:{click:function(e){return t.preNextDay(-1)}}}),s("font-awesome-icon",{staticClass:"absolute right-[-3px] top-[-41px] text-2xl text-primary",attrs:{icon:"fa-solid fa-angle-right"},on:{click:function(e){return t.preNextDay(1)}}})],1)])]),s("div",{staticClass:"mt-2"},[s("div",{staticClass:"flex"},[s("div",{staticClass:"w-[25%] border border-solid border-primary"}),s("div",{staticClass:"w-[75%] border border-solid border-primary"},[s("span",[t._v(t._s(t.$dayjs(t.currentDay).format("M/D")))]),s("span",[t._v(t._s(t.$dayjs(t.currentDay).format("(dd)")))])])]),s("div",t._l(t.attributes,(function(e,a){return s("div",{key:"resultItem"+a,staticClass:"flex"},[s("div",{staticClass:"w-[25%] border border-solid border-primary"},[t._v(t._s(e.time))]),t._l(e.date,(function(e,a){return s("div",{key:"innerItem"+a,staticClass:" flex w-[75%] cursor-pointer flex-wrap items-center justify-center border border-solid border-primary"},[Array.isArray(e)&&e.length>0?[t._l(e,(function(e,i){return[s("p",{key:"attributes"+a+"-"+i,staticClass:"my-1 w-full overflow-hidden text-ellipsis whitespace-nowrap bg-second p-1 text-xs leading-tight text-white ",class:e.customData.class,on:{click:function(s){return t.doRoute(e)},keypress:function(s){return t.doRoute(e)}}},[t._v(t._s(e.customData.title))])]}))]:t._e()],2)}))],2)})),0)])])},b=[],k={props:{value:{type:[String,Date],required:!0},weekLst:{type:[Array]},attributes:{type:[Array],default:()=>[]},isRegularHoliday:{type:[Array],default:()=>[]},manaulUpdateFormResult:{type:[Function],required:!0}},methods:{doRoute(t){console.log(t);const e=["break","regularHoliday"];e.includes(t.customData.type)?this.$swal.fire({icon:"info",title:`${t.customData.title}`,showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"開放預約",customClass:{confirmButton:"!w-[144px] !rounded !bg-second !px-[14px] !py-2 !text-sm !text-white"},cancelButtonText:"關閉"}).then((async e=>{if(e.isConfirmed){if("break"===t.customData.type&&await this.$api.adminBookingTime({designerId:this.userInfo.user.id,datetime:t.dates,appointable:!0}),"bg-blue-400 text-white"===t.customData.class&&await this.$api.adminBookingTime({designerId:this.userInfo.user.id,datetime:t.dates,appointable:!0}),"bg-blue-600 text-white"===t.customData.class){const e=t.customData.bookingTimes.map((t=>new Promise((e=>{e(this.$api.adminBookingTime({designerId:this.userInfo.user.id,datetime:t.time,appointable:!0}))}))));await Promise.all(e)}await this.manaulUpdateFormResult()}})):this.$router.push({name:"ScheduleBreak-Detail",query:{id:t.key}})},preNextDay(t){this.currentDay=this.$dayjs(this.$dayjs(this.currentDay).add(t,"days")).format("YYYY-MM-DD")}},computed:{...(0,r.rn)("userInfo",["userInfo","currentMechantId"]),currentDay:{get(){return this.value},set(t){this.$emit("input",t)}}}},v=k,D=(0,u.Z)(v,x,b,!1,null,null,null),C=D.exports,$={name:"order-index",description:"行事曆的首頁",metaInfo:{title:"名留",titleTemplate:"%s | 行事曆"},components:{MonthView:m,WeekView:w,DayView:C},data(){return{seletedAll:!1,isActiveFilter:!1,isDirect:!1,isAuthToAll:!1,designerBookingList:[],seleted:["my","others","break","regularHoliday"],showType:"0",period:0,monthlyOrdersDate:{start:this.$dayjs(new Date).startOf("month").valueOf(),end:this.$dayjs(new Date).endOf("month").valueOf()},today:this.$dayjs().format("YYYY-MM-DD"),attributes:[],formatResult:[],timeListOfBookings:[]}},mounted(){this.init()},methods:{async init(){await this.getIsMerchantScheduleDisplay(),await this.getDesignerBookingTimesWithRange()},async getIsMerchantScheduleDisplay(){const t=await this.$api.getIsMerchantScheduleDisplay(),{data:e,errors:s}=t.data;s||(this.isAuthToAll=e.getIsMerchantScheduleDisplay)},async getAllBookingTimesWithRange(){const t=new Map([["0",{startDate:this.$dayjs(this.monthlyOrdersDate.start).valueOf(),endDate:this.$dayjs(this.monthlyOrdersDate.end).valueOf()}],["1",{startDate:this.$dayjs(this.weekLst[0]).valueOf(),endDate:this.$dayjs(this.weekLst[6]).valueOf()}],["2",{startDate:this.$dayjs(this.$dayjs(this.today).format("YYYY-MM-DD 00:00:00")).valueOf(),endDate:this.$dayjs(this.$dayjs(this.today).format("YYYY-MM-DD 23:59:59")).valueOf()}]]),e={storeId:this.currentMechantId,dateRange:{startDate:t.get(this.showType).startDate,endDate:t.get(this.showType).endDate}},s=await this.$api.getAllBookingTimesWithRange(e),{data:a,errors:i}=s.data;if(i)return;this.formatResult=[];const r=a.getAllBookingTimesWithRange.flatMap((t=>Array.isArray(t.schedule)&&t.schedule.length>0?[...t.schedule.map((e=>({...e,designer:t.designer})))]:[]));this.timeListOfBookings=r,this.formatResult=[...this.ordersList(r),...this.HolidayList(r),...this.HolidayTimeRangeList(r),...this.dayOffList(r)]},async getDesignerBookingTimesWithRange(){const t=new Map([["0",{startDate:this.$dayjs(this.monthlyOrdersDate.start).valueOf(),endDate:this.$dayjs(this.monthlyOrdersDate.end).valueOf()}],["1",{startDate:this.$dayjs(this.weekLst[0]).valueOf(),endDate:this.$dayjs(this.weekLst[6]).valueOf()}],["2",{startDate:this.$dayjs(this.$dayjs(this.today).format("YYYY-MM-DD 00:00:00")).valueOf(),endDate:this.$dayjs(this.$dayjs(this.today).format("YYYY-MM-DD 23:59:59")).valueOf()}]]),e={designerId:this.userInfo.user.id,storeId:this.currentMechantId,dateRange:{startDate:t.get(this.showType).startDate,endDate:t.get(this.showType).endDate}},s=await this.$api.getDesignerBookingTimesWithRange(e),{data:a,errors:i}=s.data;if(i)return;const r=a.getDesignerBookingTimesWithRange.map((t=>({...t,designer:this.designer})));this.timeListOfBookings=r,this.formatResult=[],this.formatResult=[...this.ordersList(r),...this.HolidayList(r),...this.HolidayTimeRangeList(r),...this.dayOffList(r)]},HolidayList(t){console.log(t);let e=[];return Array.isArray(t)&&t.length>0&&(e=t.flatMap(((t,e)=>t.isRegularHoliday?[{key:`HolidayList-${e}`,customData:{title:`${t.designer.name}公休`,class:"bg-blue-600 text-white",type:"regularHoliday",designer:t.designer,bookingTimes:t.bookingTimes},dates:t.date}]:[]))),e},HolidayTimeRangeList(t){let[e=[],s=[],a=[],i=[]]=[];return e=t.flatMap((t=>Array.isArray(t.bookingTimes)&&t.bookingTimes.length>0?[t.bookingTimes.map((e=>({...e,designer:t.designer})))]:[])),s=e.flatMap((t=>[...t])),a=s.flatMap((t=>t.statusComment&&"該時段公休"===t.statusComment?[t]:[])),i=a.map(((t,e)=>({key:`HolidayTimeRangeList-${e}`,customData:{title:`${t.designer.name}公休${this.$dayjs(t.time).format("HH:mm")}`,class:"bg-blue-400 text-white",type:"regularHoliday",designer:t.designer},dates:t.time}))),i},dayOffList(t){let[e=[],s=[],a=[],i=[]]=[];return e=t.flatMap((t=>Array.isArray(t.bookingTimes)&&t.bookingTimes.length>0?[t.bookingTimes.map((e=>({...e,designer:t.designer})))]:[])),s=e.flatMap((t=>[...t])),a=s.flatMap((t=>t.statusComment&&"該時段排休"===t.statusComment?[t]:[])),i=a.map(((t,e)=>({key:`dayOffList-${e}`,customData:{title:`${t.designer.name}排休${this.$dayjs(t.time).format("HH:mm")}`,class:"bg-red-600 text-white",type:"break",designer:t.designer},dates:t.time}))),i},ordersList(t){let[e=[],s=[],a=[],i=[]]=[];return e=t.flatMap((t=>Array.isArray(t.bookingTimes)&&t.bookingTimes.length>0?[t.bookingTimes.map((e=>({...e,designer:t.designer})))]:[])),s=e.flatMap((t=>[...t])),a=s.flatMap((t=>Array.isArray(t.orders)&&t.orders.length>0?[...t.orders.map((e=>({...e,propsDesigner:t.designer})))]:[])),i=a.map((t=>{let e="";return e=t.propsDesigner.id===this.userInfo.user.id?t.designer&&t.designer.id===this.userInfo.user.id?"bg-second text-white":"bg-green-500 text-white":"bg-slate-200 text-green-600",{key:t.id,customData:{title:t.customer.name||"--",class:e,type:t.isDesignate?"my":"others"},dates:t.date}})),i},doRoute(t){this.$router.push({name:t.name})},async manaulUpdateFormResult(){this.seletedAll?await this.getAllBookingTimesWithRange():await this.getDesignerBookingTimesWithRange()}},activated(){this.init()},computed:{...(0,r.rn)("userInfo",["userInfo","currentMechantId","userAuthorizeList"]),...(0,r.Se)("userInfo",["GETTER_MECHANTNAME"]),isAuthority(){return t=>this.userAuthorizeList.find((e=>e.pageName===t&&e.authority))},designer(){return{id:this.userInfo.user.id,name:this.userInfo.user.name}},restructureScheduleTableWithisRegualrHoliday(){return this.formatResult.filter((t=>t.key.includes("HolidayList")))},restructureScheduleTableWithTimeList(){let t=[],e=[],s=[];t=this.timeListOfBookings.flatMap((t=>t.bookingTimes?t.bookingTimes.flatMap((t=>t?[this.$dayjs(t.time).isValid()?this.$dayjs(t.time).format("HH:mm"):[]]:[])):[])),e=[...new Set(t)];const a=this.formatResult.filter((t=>0!==this.seleted.length&&this.seleted.includes(t.customData.type)));return s=e.flatMap((t=>{let[e,s,i,r,o,n,l]=[];return e=Array.isArray(a)?a.filter((e=>this.$dayjs(e.dates).isBetween(this.weekLst[0],this.weekLst[1])&&this.$dayjs(e.dates).format("HH:mm")===t)):"",s=Array.isArray(a)?a.filter((e=>this.$dayjs(e.dates).isBetween(this.weekLst[1],this.weekLst[2])&&this.$dayjs(e.dates).format("HH:mm")===t)):"",i=Array.isArray(a)?a.filter((e=>this.$dayjs(e.dates).isBetween(this.weekLst[2],this.weekLst[3])&&this.$dayjs(e.dates).format("HH:mm")===t)):"",r=Array.isArray(a)?a.filter((e=>this.$dayjs(e.dates).isBetween(this.weekLst[3],this.weekLst[4])&&this.$dayjs(e.dates).format("HH:mm")===t)):"",o=Array.isArray(a)?a.filter((e=>this.$dayjs(e.dates).isBetween(this.weekLst[4],this.weekLst[5])&&this.$dayjs(e.dates).format("HH:mm")===t)):"",n=Array.isArray(a)?a.filter((e=>this.$dayjs(e.dates).isBetween(this.weekLst[5],this.weekLst[6])&&this.$dayjs(e.dates).format("HH:mm")===t)):"",l=Array.isArray(a)?a.filter((e=>this.$dayjs(e.dates).isBetween(this.$dayjs(this.weekLst[6]).format("YYYY-MM-DD 00:00:00"),this.weekLst[6])&&this.$dayjs(e.dates).format("HH:mm")===t)):"",[{time:t,date:[e,s,i,r,o,n,l]}]})),s},restructureScheduleTableWithTimeListOfDay(){let t=[],e=[],s=[];t=this.timeListOfBookings.flatMap((t=>t.bookingTimes?t.bookingTimes.flatMap((t=>t?[this.$dayjs(t.time).isValid()?this.$dayjs(t.time).format("HH:mm"):[]]:[])):[])),e=[...new Set(t)];const a=this.formatResult.filter((t=>0!==this.seleted.length&&this.seleted.includes(t.customData.type)));return s=e.flatMap((t=>{let[e]=[];return e=Array.isArray(a)?a.filter((e=>this.$dayjs(e.dates).isBetween(this.$dayjs(this.today).format("YYYY-MM-DD 00:00:00"),this.$dayjs(this.today).format("YYYY-MM-DD 23:59:59"))&&this.$dayjs(e.dates).format("HH:mm")===t)):"",[{time:t,date:[e]}]})),s},weekLst(){return[this.$dayjs(this.$dayjs().format("YYYY-MM-DD 00:00:00")).day(this.period),this.$dayjs(this.$dayjs().format("YYYY-MM-DD")).day(this.period+1),this.$dayjs(this.$dayjs().format("YYYY-MM-DD")).day(this.period+2),this.$dayjs(this.$dayjs().format("YYYY-MM-DD")).day(this.period+3),this.$dayjs(this.$dayjs().format("YYYY-MM-DD")).day(this.period+4),this.$dayjs(this.$dayjs().format("YYYY-MM-DD")).day(this.period+5),this.$dayjs(this.$dayjs().format("YYYY-MM-DD 23:59:59")).day(this.period+6)]}},watch:{seletedAll(){this.seletedAll?this.getAllBookingTimesWithRange():this.getDesignerBookingTimesWithRange()},monthlyOrdersDate:{deep:!0,handler(){this.manaulUpdateFormResult()}},weekLst:{deep:!0,handler(){this.manaulUpdateFormResult()}},today:{deep:!0,handler(){this.seletedAll?this.getAllBookingTimesWithRange():this.getDesignerBookingTimesWithRange()}},showType(){this.seletedAll?this.getAllBookingTimesWithRange():this.getDesignerBookingTimesWithRange()}}},_=$,T=(0,u.Z)(_,a,i,!1,null,null,null),M=T.exports}}]);
//# sourceMappingURL=529.7747e7b5.js.map